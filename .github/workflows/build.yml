name: Build Durangling

on:
  push:
    branches: [ "master" ] # Gatilho para pushes na branch main
  workflow_dispatch: # Permite acionar manualmente

jobs:
  build:
    runs-on: windows-latest # Usa um runner Windows pois precisa do MSBuild e C++

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup .NET SDK 9.0
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x' # Especifica a versão do .NET SDK

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2 # Configura o ambiente MSBuild/VS

    - name: Build Solution (including Detours)
      run: msbuild Durangling.sln /p:Configuration=ReleaseMD /p:Platform=x64
      # Compila a solução inteira com a configuração necessária para Detours

    - name: Publish Mod Project
      # Substitua 'TestgroundMod' pelo nome real do seu projeto de mod se for diferente
      # O caminho 'TestgroundMod\TestgroundMod.csproj' pode precisar ser ajustado
      run: dotnet publish TestgroundMod\TestgroundMod.csproj --configuration Release --runtime win-x64 --output ./publish_output
      # Publica o projeto do mod para a pasta 'publish_output'

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Durangling-Build # Nome do artefato para download
        path: ./publish_output # Caminho para os arquivos que serão incluídos no artefato